<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Gravatar Redirect Channel</title>
      <meta name="description" content="Want to look up a Gravatar for a given email address? Enter it here and we'll point you to the image!">

      <meta property="og:title" content="Gravatar Redirect Channel">
      <meta property="og:type" content="website">
      <meta property="og:url" content="https://gravatar.redirect.channel">
      <meta property="og:image" content="og-image.png">
      <meta property="og:image:alt" content="Enter an email address, get its gravatar.com image.">

      <link rel="icon" href="favicon.ico" sizes="any">
      <link rel="apple-touch-icon" href="apple-touch-icon.png">

      <link rel="manifest" href="site.webmanifest">
      <meta name="theme-color" content="#fafafa">
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&family=Freeman&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap">
      <link rel="stylesheet" href="style.css">

      <script async type="module" src="gravatarizer.js"></script>
      <script async type="module" src="email_domain_suggester.js"></script>
  </head>

  <body class="container">
    <main>
      <section class="primary-content">
        <header>
          <h1>Gravatar Redirect Channel</h1>
        </header>

        <article>
          <span class="random-face">
            <img src="images/face-4.svg" alt="abstract avatar">
          </span>

          <h2>Find someone's <a href="https://gravatar.com" target="blank">Gravatar</a>!</h2>

          <form action="gravatarize.php" method="GET">
            <label for="email">Email</label>
            <input type="email" id="email" placeholder="you@place.com" autocomplete="email" required>
            <button type="submit">Gravatarize!</button>
          </form>
        </article>
      </section>

      <section class="splash">
      </section>

    </main>

    <footer>
      <section class="footer-content">
        <article>
          <h2>Advanced Usage</h2>

          <p>An advanced feature is to place the email address directly in the address bar. Example:</p>

          <p><code>gravatar.redirect.channel/you@place.com</code></p>

          <p>This will immediately redirect you to the gravatar image URL for the email provided.</p>
        </article>

        <article>
          <h2>Nerd Details</h2>

          <p>This was originally a static page, hosted by <a href="https://pages.github.com/">GitHub Pages</a> (because it's free.) Because it was a static site, it couldn't do the trivial server-side transformations on the email address, so there was a <a href="gravatarizer.js">minimal amount of Javascript</a> in this page to handle the necessary processing.</p>

          <p>Since then, I've also implemented the redirect as an <a href="nginx/nginx.conf">nginx config</a> and <a href="nginx/gravatarize.js">accompanying js file</a> that makes use of nginx's <a href="https://nginx.org/en/docs/http/ngx_http_js_module.html">http_js module</a>, but I gave up trying to find a cheap web hosting provider that offered support for custom nginx configs or its http_js module.</p>

          <p>Next, I <a href="/terraform/">explored</a> using <a href="https://developer.hashicorp.com/terraform/intro">Terraform</a> to provision:</p>

          <ul>
            <li>a Route53 zone</li>
            <li>an ACM SSL certificate</li>
            <li>an S3 bucket (with appropriate settings to host static html/css/js from)</li>
            <li>an AWS Lambda (and IAM permissions)</li>
            <li>necessary routing to the lambda</li>
            <li>and AWS Budget alerts to prevent runaway spend</li>
          </ul>

          <p>When the <a href="terraform/main.tf">main.tf</a> file crossed 200 lines though, I gave up on that approach. ðŸ™„ I might have been able to run that version for less than $1 USD per month, but I would have spent the rest of my life managing the infrastructure as code.</p>

          <p>Ultimately, I went back to the most basic, widely available, cheap, fast, server side logic there is: <a href="gravatarize.phps">PHP</a>. Every single hosting provider on the planet has support for it out of the box, and it's trivial to deploy to any of these services, even the free ones.</p>

          <p>For the advanced URL usage, at first the Javascript in this page would pick that out of the address bar in your browser, and initiate the redirect automatically. Just like with the vast majority of Javascript these days, we jump through ridiculous hoops and contort ourselves to the point that phrases like &quot;Javascript build pipeline&quot; go completely unnoticed. But! This ended up being the reason I had to move off Github Pages, because adding an email into the URL just caused a <code>404</code> (since there was no static file named as any given email address to serve) and Pages doesn't provide any way to control the 404 or repurpose it as a redirect.</p>

          <p>So since this is (again) trivial on the server-side, and you can't beat free hosting with ubiquitous PHP and <code>.htaccess</code> support, I <a href=".htaccess">wrote the Apache directives</a> and pushed to <a href="https://heliohost.org/">HelioHost</a>, where you're now reading this from. Compared to everything else I tried, this final attempt amounted to approximately 5% of the total time I've spent on this project, so HelioHost got a nice <a href="https://heliohost.org/#aboutus">donation</a> from me, that happens to also lock in my hosting account more or less indefinitely.</p>
        </article>
      </section>

      <section class="footer-content">
        <article>
          <h2>Credits and Copyright</h2>

          <p>This single use site is the product of a deranged facsination with <a href="https://gist.github.com/beporter/0f7b23ad032a1871e71654a27a306516">incorrect ChatGPT bash script output</a>. All uses, trademarks, whatever of &quot;Gravatar&quot; are the property of Automattic. I looked through their terms of service, privacy policy, user guidelines, and pretty much any other legal doc I could find, but none of them explicitly spelled out whether this is acceptable use or not.</p>

          <p>Design, images and logo courtesy of <a href="https://chrispeak.com/">Chris Peak</a>. One day he's going to get tired of entertaining my nonsense.</p>

          <p class="copyright">This site itself is Copyright &copy; 2025+ <a href="https://github.com/beporter">Brian Porter</a>. That said; it's an html file and a php file, and everything is <a href="https://github.com/beporter/gravatar.redirect.channel">hosted on GitHub</a>. So view the source, learn, and use what's interesting. Pointing back here or at least to the tools credited above directly would be nice.</p>
        </article>
      </section>
    </footer>

    <script type="module" src="main.js"></script>
    <noscript>
      <p><s>Unfortunately, as stated above, this site requires Javascript to function correctly. You're seeing this message because Javascript is currently disabled in your browser.</s></p>

      <p>This site used to require Javascript. Now it doesn't. So if you're seeing this paragraph, everything still works! It's a 2025 web development miracle!</p>
    </noscript>
  </body>
</html>
